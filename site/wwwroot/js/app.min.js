(function(){"use strict";angular.module("timeline",[])})(),function(){"use strict";var n=function(n,t,i,r,u){var f=this;f.type=undefined;f.init=function(n){f.type=n;r.getData(n).length===0&&r.read(n).then(i.inject).then(function(){r.preread(n)})};f.getData=function(){return r.getData(f.type)};f.readMore=function(){u.is()||(r.read(f.type).then(function(){r.preread(f.type)}),i.click(f.type,"Read More"))};f.open=function(n){t.open(n.Url,"_blank");i.click(f.type,"Read")};f.toggleSocials=function(n){n.socials?(n.socials=!1,i.click(f.type,"Close Share")):(n.socials=!0,i.click(f.type,"Open Share"))};f.shareVk=function(n){t.open("http://vk.com/share.php?url="+n.Url,"_blank");i.click(f.type,"Share with VK")};f.shareTw=function(n){t.open("https://twitter.com/intent/tweet?text="+n.Title+"&url="+n.Url+"&via=bstutimeline","_blank");i.click(f.type,"Share with Twitter")};f.shareFb=function(n){t.open("http://www.facebook.com/sharer/sharer.php?u="+n.Url,"_blank");i.click(f.type,"Share with FB")};f.isLastPortion=function(){return r.isLastPortion(f.type)};n.news={init:f.init,getData:f.getData,readMore:f.readMore,open:f.open,toggleSocials:f.toggleSocials,share:{vk:f.shareVk,tw:f.shareTw,fb:f.shareFb},isLastPortion:f.isLastPortion}};angular.module("timeline").controller("NewsCtrl",["$scope","$window","AnalyticsSvc","NewsSvc","LoadingSvc",n])}(),function(){"use strict";var n=function(n,t,i,r,u){var f=this;f.showSpinner=function(){return i.is()&&(r.getData("Feed").length===0&&t.isActive("feed")||r.getData("Upcoming").length===0&&t.isActive("upcoming"))};f.showSpinnerSmall=function(){return i.is()&&(r.getData("Feed").length>0&&t.isActive("feed")||r.getData("Upcoming").length>0&&t.isActive("upcoming"))};f.toTopAnalytics=function(){var n=t.active[0].toUpperCase()+t.active.substring(1);u.click(n,"Back to the top")};f.trackLink=function(n,t){u.click(n,t)};n.root={types:t,showSpinner:f.showSpinner,showSpinnerSmall:f.showSpinnerSmall,toTopAnalytics:f.toTopAnalytics,trackLink:f.trackLink}};angular.module("timeline").controller("RootCtrl",["$scope","TypesSvc","LoadingSvc","NewsSvc","AnalyticsSvc",n])}(),function(){"use strict";var n=function(n,t){var i=function(i,r,u){function o(){var t=n.document.body.scrollHeight-n.document.body.scrollTop-n.document.body.clientHeight;t<=e?r.addClass("stick"):r.removeClass("stick");n.document.body.scrollTop>=f?r.removeClass("hidden"):r.addClass("hidden")}function s(){o();t(s,500)}function h(){n.scrollTo(0,0)}var f=parseInt(u.showAfter),e=parseInt(u.stickOn);f||(f=450);e||(e=180);r.addClass("hidden");n.document.body.clientWidth<=1024&&t(s,500);angular.element(n).on("scroll",o);r.on("click",h)};return{restrict:"E",link:i}};angular.module("timeline").directive("toTop",["$window","$timeout",n])}(),function(){"use strict";var n=function(n){var t=this;return t.trackingCode="UA-62450305-3",t.counters={},t.queue=[],t.attemp=0,t.maxAttemps=30,t.inited=!1,t.injected=!1,t.inject=function(){t.injected||(t.injected=!0,function(n,t,i,r,u,f,e){n.GoogleAnalyticsObject=u;n[u]=n[u]||function(){(n[u].q=n[u].q||[]).push(arguments)};n[u].l=1*new Date;f=t.createElement(i);e=t.getElementsByTagName(i)[0];f.async=1;f.src=r;e.parentNode.insertBefore(f,e)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"))},t.checkAvailability=function(){if(typeof ga!="function"){if(t.attemp++,t.attemp>t.maxAttemps)return;n(t.checkAvailability,1e3)}else ga(t.init)},t.init=function(){ga("create",t.trackingCode,"auto");ga("send","pageview");t.inited=!0;for(var n=0;n<t.queue;n++)ga("send","event",t.queue[n].category,t.queue[n].type,t.queue[n].label)},t.getCounter=function(n){return t.counters.hasOwnProperty(n)?(t.counters[n]++,t.counters[n]):(t.counters[n]=1,1)},t.click=function(n,i){var r=t.getCounter(n+i);i=i+" #"+r;t.inited?ga("send","event",n,"click",i):t.queue.push({type:"click",category:n,label:i})},t.checkAvailability(),t};angular.module("timeline").factory("AnalyticsSvc",["$timeout",n])}(),function(){"use strict";var n=function(){var n=this;return n.queue=[],n.is=function(){return n.queue.length!==0},n.begin=function(){n.queue.push(0)},n.end=function(){n.queue.pop()},n};angular.module("timeline").factory("LoadingSvc",[n])}(),function(){"use strict";var n=function(n,t,i){var r=this;return r.data={},r.preloaded={},r.lastPortion={},r.limit=10,r.getData=function(n){return r.data[n]||(r.data[n]=[]),r.data[n]},r.isLastPortion=function(n){return!!r.lastPortion[n]},r.read=function(u){i.begin();r.data[u]||(r.data[u]=[]);var f="/api/news/"+u+"?skip="+r.data[u].length+"&take="+r.limit;return t(function(t,e){var o;if(r.preloaded[u]&&r.preloaded[u][f]){if(r.preloaded[u][f].length){r.pushData(u,r.preloaded[u][f]);t(r.preloaded[u][f]);i.end();return}o=r.preloaded[u][f]}else o=n.get(f);o.then(function(n){r.pushData(u,n.data);t(n.data)}).catch(function(n){e(n)}).finally(function(){i.end()})})},r.preread=function(i){r.preloaded[i]||(r.preloaded[i]=[]);var u="/api/news/"+i+"?skip="+r.data[i].length+"&take="+r.limit;r.preloaded[i][u]=t(function(t,f){n.get(u).then(function(n){r.preloaded[i][u]=n.data;t(n)}).catch(function(n){f(n)})})},r.pushData=function(n,t){for(var i=0;i<t.length;i++)r.data[n].push(t[i]);t.length<r.limit&&(r.lastPortion[n]=!0)},r};angular.module("timeline").factory("NewsSvc",["$http","$q","LoadingSvc",n])}(),function(){"use strict";var n=function(n){var t=this;return t.list=[{id:"feed",text:"\u041b\u0435\u043d\u0442\u0430"},{id:"upcoming",text:"\u0411\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435"}],t.active=t.list[0].id,t.isActive=function(n){return t.active===n},t.activate=function(i){t.active=i;n.click("Go to",i)},t.text={more:function(){return t.active==="feed"?"\u0415\u0449\u0451 \u043d\u043e\u0432\u043e\u0441\u0442\u0438":"\u0415\u0449\u0451 \u0441\u043e\u0431\u044b\u0442\u0438\u044f"},none:function(){return t.active==="feed"?"\u041d\u043e\u0432\u043e\u0441\u0442\u0435\u0439 \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435\u0442":"\u0421\u043e\u0431\u044b\u0442\u0438\u0439 \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435\u0442"}},t};angular.module("timeline").factory("TypesSvc",["AnalyticsSvc",n])}();