(function(){"use strict";var n=function(n){var t=this;return t.list=[{id:"feed",text:"\u041b\u0435\u043d\u0442\u0430"},{id:"upcoming",text:"\u0411\u043b\u0438\u0436\u0430\u0439\u0448\u0435\u0435"}],t.active=t.list[0].id,t.isActive=function(n){return t.active===n},t.activate=function(i){t.active=i;n.click("Go to",i)},t},t=function(){var n=this;return n.queue=[],n.is=function(){return n.queue.length!==0},n.begin=function(){n.queue.push(0)},n.end=function(){n.queue.pop()},n},i=function(n,t,i,r,u){n.types=t;n.showSpinner=function(){return i.is()&&(r.data.length===0&&t.isActive("feed")||u.data.length===0&&t.isActive("upcoming"))};n.showSpinnerSmall=function(){return i.is()&&r.data.length>0}},r=function(n,t){var i=this;return i.data=[],i.read=function(){t.begin();n.get("/api/news/feed?skip="+i.data.length).then(function(n){for(var t=0;t<n.data.length;t++)i.data.push(n.data[t])}).finally(function(){t.end()})},i},u=function(n,t,i,r,u){n.news=r.data;n.readMore=function(){u.is()||(r.read(),i.click("Feed","Read More"))};n.open=function(n){t.open(n.Url,"_blank");i.click("Feed","Read")};n.toggleSocials=function(n){n.socials?(n.socials=!1,i.click("Feed","Close Share")):(n.socials=!0,i.click("Feed","Open Share"))};n.shareVk=function(n){t.open("http://vk.com/share.php?url="+n.Url,"_blank");i.click("Feed","Share with VK")};n.shareTw=function(n){t.open("https://twitter.com/intent/tweet?text="+n.Title+"&url="+n.Url+"&via=bstutimeline","_blank");i.click("Feed","Share with Twitter")};n.shareFb=function(n){t.open("http://www.facebook.com/sharer/sharer.php?u="+n.Url,"_blank");i.click("Feed","Share with FB")};r.data.length===0&&r.read()},f=function(n,t){var i=this;return i.data=[],i.read=function(){t.begin();n.get("/api/news/upcoming?skip="+i.data.length).then(function(n){for(var t=0;t<n.data.length;t++)i.data.push(n.data[t])}).finally(function(){t.end()})},i},e=function(n,t,i,r,u){n.news=r.data;n.readMore=function(){u.is()||(r.read(),i.click("Upcoming","Read More"))};n.open=function(n){t.open(n.Url,"_blank");i.click("Upcoming","Read")};n.toggleSocials=function(n){n.socials?(n.socials=!1,i.click("Upcoming","Close Share")):(n.socials=!0,i.click("Upcoming","Open Share"))};n.shareVk=function(n){t.open("http://vk.com/share.php?url="+n.Url,"_blank");i.click("Upcoming","Share with VK")};n.shareTw=function(n){t.open("https://twitter.com/intent/tweet?text="+n.Title+"&url="+n.Url+"&via=bstutimeline","_blank");i.click("Upcoming","Share with Twitter")};n.shareFb=function(n){t.open("http://www.facebook.com/sharer/sharer.php?u="+n.Url,"_blank");i.click("Upcoming","Share with FB")};r.data.length===0&&r.read()},o=function(n){var t=function(t,i,r){var u=parseInt(r.showAfter);u||(u=450);i.addClass("hidden");angular.element(n).on("scroll",function(){n.document.body.scrollTop>u?i.removeClass("hidden"):i.addClass("hidden")});i.on("click",function(){n.scrollTo(0,0)})};return{restrict:"E",link:t}},s=function(){var n=this;return n.counters={},n.getCounter=function(t){return n.counters.hasOwnProperty(t)?(n.counters[t]++,n.counters[t]):(n.counters[t]=1,1)},n.click=function(t,i){var r=n.getCounter(t+i);ga("send","event",t,"click",i+" #"+r)},n};angular.module("timeline",[]).factory("TypesSvc",["AnalyticsSvc",n]).factory("LoadingSvc",[t]).controller("RootCtrl",["$scope","TypesSvc","LoadingSvc","FeedSvc","UpcomingSvc",i]).factory("FeedSvc",["$http","LoadingSvc",r]).controller("FeedCtrl",["$scope","$window","AnalyticsSvc","FeedSvc","LoadingSvc",u]).factory("UpcomingSvc",["$http","LoadingSvc",f]).controller("UpcomingCtrl",["$scope","$window","AnalyticsSvc","UpcomingSvc","LoadingSvc",e]).directive("toTop",["$window",o]).factory("AnalyticsSvc",["$timeout",s])})();